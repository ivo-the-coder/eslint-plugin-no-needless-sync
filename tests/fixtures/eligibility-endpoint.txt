const availableFundsCall = require('../../available/repository/available-funds-call');
const {
checkEligibility: checkAvailableEligibility
} = require('../../available/repository/eligibility');
const currentFunds = require('../../current/repository');
const {
checkEligibility: checkTargetPortfolioEligibility
} = require('../../funds-switch/repository/eligibility');
const {
checkEligibility: checkPiaEligibility
} = require('../../pia/repository/eligibility');
const { getPackageCall } = require('../../pia/repository/get-package-call');

const checkEligibility = async (currentProduct, identity, correlationId) => {
const { id: policyNumber } = currentProduct;

 const currentFundsBody = await currentFunds(
currentProduct,
identity,
correlationId
);
const availableFundsBody = await availableFundsCall(
currentProduct,
identity,
correlationId
);
const fundPackageBody = await getPackageCall(
policyNumber,
identity,
correlationId
);

 return {
availableFunds: checkAvailableEligibility(currentFundsBody.funds),
targetPortfolio: checkTargetPortfolioEligibility(
currentFundsBody.funds,
availableFundsBody.funds
),
currentPIA: checkPiaEligibility(fundPackageBody)
};
};

module.exports = { checkEligibility };